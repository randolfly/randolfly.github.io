import{_ as l}from"./plugin-vue_export-helper.21dcd24c.js";import{o as c,c as r,b as s,d as a,w as p,a as e,e as n,r as i}from"./app.8dee8b14.js";const u={},m=e('<h1 id="s-function" tabindex="-1"><a class="header-anchor" href="#s-function" aria-hidden="true">#</a> s function</h1><h1 id="s-function-1" tabindex="-1"><a class="header-anchor" href="#s-function-1" aria-hidden="true">#</a> S Function</h1><h2 id="\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u4E49" aria-hidden="true">#</a> \u5B9A\u4E49</h2><blockquote><p>S-functions (system-function) provide a mechanism for extending the capability of simulink environment using the mex utility.</p></blockquote><p>S-function \u5B9A\u4E49\u4E86\u5728\u4EFF\u771F\u73AF\u5883\u4E2D\u4E00\u4E2A block \u662F\u5982\u4F55\u6267\u884C\u7684\uFF0C\u5305\u542B\uFF1Ainitialization, update, derivates, output \u548C termination. \u5728\u5176\u4E2D\u7684\u6BCF\u4E00\u4E2A\u6B65\u9AA4\uFF0Csimulink engine \u90FD\u4F1A\u8C03\u7528\u4E00\u4E2A method \u53BB\u5B9E\u73B0\u5177\u4F53\u7684\u7EC6\u8282\u3002</p>',5),d=n("\u9996\u5148\uFF0C\u4E3A\u4E86\u7406\u89E3 s function \u600E\u4E48\u5DE5\u4F5C\u7684\uFF0C\u53EF\u4EE5\u53C2\u8003 "),k=n("simulink \u6267\u884C\u7EC6\u8282"),h=n(" \u3002"),v=e('<h2 id="simulink-\u6A21\u5757\u7684\u6570\u5B66\u8868\u8FF0" tabindex="-1"><a class="header-anchor" href="#simulink-\u6A21\u5757\u7684\u6570\u5B66\u8868\u8FF0" aria-hidden="true">#</a> Simulink \u6A21\u5757\u7684\u6570\u5B66\u8868\u8FF0</h2><p>\u4E00\u4E2A Simulink \u6A21\u5757\u53EF\u4EE5\u8BA4\u4E3A\u6709\u4EE5\u4E0B\u6210\u5206\u7EC4\u6210\uFF1A</p><ul><li>\u8F93\u5165\u96C6\u5408</li><li>\u72B6\u6001\u96C6\u5408</li><li>\u53C2\u6570\u96C6\u5408</li><li>\u8F93\u51FA\u96C6\u5408</li></ul><p>\u53EF\u4EE5\u8868\u793A\u6210\u4E0B\u9762\u7684\u6570\u5B66\u5F62\u5F0F\uFF1A</p><p class="katex-block"><span class="katex-display fleqn"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord">\u02D9</span></span></span></span></span></span></span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.2107em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.2975em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:2em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">u</span><span class="mord mathnormal">tp</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:2em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Der</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">es</span><span class="mclose">)</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.2559em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:2em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal">p</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>\u5176\u4E2D <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> \u662F\u7CFB\u7EDF\u72B6\u6001\uFF0C<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> \u662F\u7CFB\u7EDF\u8F93\u5165\uFF0C<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> \u662F\u7CFB\u7EDF\u8F93\u51FA\u3002</p><h2 id="\u4EFF\u771F\u9636\u6BB5\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#\u4EFF\u771F\u9636\u6BB5\u5206\u6790" aria-hidden="true">#</a> \u4EFF\u771F\u9636\u6BB5\u5206\u6790</h2>',7),b=n("\u53EF\u4EE5\u53C2\u8003 "),f=n("simulink \u6267\u884C\u7EC6\u8282"),g=n(" \u3002"),_=e('<h2 id="s-function-\u56DE\u8C03\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#s-function-\u56DE\u8C03\u51FD\u6570" aria-hidden="true">#</a> S Function \u56DE\u8C03\u51FD\u6570</h2><p>\u5728 simulink \u4EFF\u771F\u8FC7\u7A0B\u4E2D\uFF0C\u4F1A\u6267\u884C\u4E0D\u540C\u7684\u56DE\u8C03\u51FD\u6570\uFF0C\u53EF\u4EE5\u5206\u7C7B\u4E3A\u4E0B\u5217\u90E8\u5206\uFF1A</p><ul><li>\u7F16\u8BD1\u9636\u6BB5: Simulink engine \u521D\u59CB\u5316 s function <ul><li>\u5C06\u5E93\u5757\u5408\u5E76\u5230\u6A21\u578B\u4E2D\uFF0C\u5E76\u4F20\u64AD\u4FE1\u53F7\u5BBD\u5EA6\u3001\u6570\u636E\u7C7B\u578B\u548C\u6837\u672C\u65F6\u95F4</li><li>\u8BBE\u7F6E\u8F93\u5165\u8F93\u51FA\u7AEF\u53E3\u6570\u91CF\u548C\u7EF4\u5EA6</li><li>\u8BA1\u7B97\u6A21\u5757\u53C2\u6570\uFF0C\u5206\u914D\u6A21\u5757\u5185\u5B58</li></ul></li><li>\u8BA1\u7B97\u8F93\u51FA\u9636\u6BB5 <ul><li>\u8BA1\u7B97\u7CFB\u7EDF\u8F93\u51FA\uFF0C\u6EE1\u8DB3\u6240\u6709\u8F93\u51FA\u7AEF\u53E3\u7684\u6761\u4EF6\uFF0C\u4F7F\u5F97\u4E0B\u6B21\u4EFF\u771F\u6B63\u5E38\u6267\u884C</li></ul></li><li>\u66F4\u65B0\u79BB\u6563\u72B6\u6001 <ul><li>\u66F4\u65B0\u7CFB\u7EDF\u7684\u6A21\u5757\u72B6\u6001</li></ul></li><li>\u521D\u59CB\u5316\u548C\u7EC8\u6B62\u65B9\u6CD5 <ul><li>\u8FD9\u4E9B\u53EF\u9009\u65B9\u6CD5\u53EA\u6267\u884C\u4E00\u6B21 S-function \u6240\u9700\u7684\u521D\u59CB\u5316\u548C\u7EC8\u6B62\u6D3B\u52A8\u3002\u521D\u59CB\u5316\u6D3B\u52A8\u53EF\u80FD\u5305\u62EC\u8BBE\u7F6E\u7528\u6237\u6570\u636E\uFF0C\u6216\u5728 s \u51FD\u6570\u4E2D\u521D\u59CB\u5316\u72B6\u6001\u5411\u91CF\u3002\u7EC8\u6B62\u65B9\u6CD5\u6267\u884C\u8BF8\u5982\u5728\u7EC8\u6B62\u4EFF\u771F\u6216\u4ECE\u6A21\u578B\u4E2D\u5220\u9664 S-function \u5757\u65F6\u6240\u9700\u7684\u5185\u5B58\u91CA\u653E\u7B49\u4EFB\u4F55\u64CD\u4F5C</li></ul></li><li>\u96C6\u6210\u90E8\u5206 <ul><li>\u8FD9\u9002\u7528\u4E8E\u5177\u6709\u8FDE\u7EED\u72B6\u6001\u548C/\u6216\u975E\u62BD\u6837\u96F6\u4EA4\u53C9\u7684\u6A21\u578B\u3002\u5982\u679C\u4F60\u7684 s \u51FD\u6570\u6709\u8FDE\u7EED\u7684\u72B6\u6001\uFF0C\u5F15\u64CE\u5728\u5C0F\u7684\u65F6\u95F4\u6B65\u4E0A\u8C03\u7528\u4F60\u7684 s \u51FD\u6570\u7684\u8F93\u51FA\u548C\u5BFC\u6570\u90E8\u5206\u3002\u8FD9\u6837\u6C42\u89E3\u5668\u5C31\u53EF\u4EE5\u8BA1\u7B97 s \u51FD\u6570\u7684\u72B6\u6001\u3002\u5982\u679C\u60A8\u7684 s \u51FD\u6570\u5177\u6709\u975E\u91C7\u6837\u7684\u96F6\u4EA4\u53C9\u70B9\uFF0C\u5F15\u64CE\u4E5F\u4F1A\u5728\u8F83\u5C0F\u7684\u65F6\u95F4\u6B65\u9AA4\u4E2D\u8C03\u7528 s \u51FD\u6570\u7684\u8F93\u51FA\u548C\u96F6\u4EA4\u53C9\u70B9\u90E8\u5206\uFF0C\u4EE5\u4FBF\u5B83\u53EF\u4EE5\u5B9A\u4F4D\u96F6\u4EA4\u53C9\u70B9\u3002</li></ul></li></ul>',3),y=n("\u66F4\u7EC6\u81F4\u7684\u7ED3\u6784\u53EF\u4EE5\u53C2\u8003 "),S={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/s-function-concepts.html",target:"_blank",rel:"noopener noreferrer"},w=n("S-Function Concepts"),D=n(" \u3002"),T=e('<p>\u6B64\u5916\uFF0C\u9700\u8981\u6CE8\u610F s function \u4E0E\u5176\u4F59\u5B9E\u73B0\u65B9\u5F0F\u7684\u533A\u522B\uFF0C\u53C2\u8003\u4E0B\u8868\uFF1A</p><p><strong>Compare and contrast features supported by different types of S-function implementations.</strong></p><h3 id="s-function-features" tabindex="-1"><a class="header-anchor" href="#s-function-features" aria-hidden="true">#</a> S-Function Features</h3><p>The following tables give overviews of the features supported by different types of S-functions. The first table focuses on handwritten S-functions. The second table compares the features of S-functions automatically generated by the S-Function Builder or Legacy Code Tool.</p><p><strong>Features of Hand-Written S-Functions</strong></p><table summary="Features of Hand-Written S-Functions"><colgroup><col width="15%"><col width="29%"><col width="27%"><col width="29%"></colgroup><thead><tr><th>Feature</th><th>Level-1 MATLAB S-Function</th><th>Level-2 MATLAB S-Function</th><th>Handwritten C MEX S-Function</th></tr></thead><tbody><tr><td>Data types</td><td>Supports signals with a data type of <code>double</code>.</td><td>Supports any data type supported by Simulink<sup>\xAE</sup> software, including fixed-point types.</td><td>Supports any data type supported by Simulink software, including fixed-point types.</td></tr><tr><td>Numeric types</td><td>Supports only real signals.</td><td>Supports real and complex signals.</td><td>Supports real and complex signals.</td></tr><tr><td>Frame support</td><td>Does not support frame-based signals.</td><td>Supports framed and unframed signals.</td><td>Supports framed and unframed signals.</td></tr><tr><td>Port dimensions</td><td>Supports vector inputs and outputs. Does not support multiple input and output ports.</td><td>Supports scalar, 1-D, and multidimensional input and output signals.</td><td>Supports scalar, 1-D, and multidimensional input and output signals.</td></tr><tr><td>S-function API</td><td>Supports only <code>mdlInitializeSizes</code>, <code>mdlDerivatives</code>, <code>mdlUpdate</code>, <code>mdlOutputs</code>, <code>mdlGetTimeOfNextVarHit</code>, and <code>mdlTerminate</code>.</td><td>Supports a larger set of the S-function API. See <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/writing-level-2-matlab-s-functions.html#f7-68222">Level-2 MATLAB S-Function Callback Methods</a> for a list of supported methods.</td><td>Supports the entire S-function API.</td></tr><tr><td>Code generation support</td><td>Does not support code generation.</td><td>Requires a handwritten TLC file to generate code.</td><td>Natively supports code generation. Requires a handwritten TLC file to inline the S-function during code generation.</td></tr><tr><td>Simulink Accelerator mode</td><td>Runs interpretively and is, therefore, not accelerated.</td><td>Provides the option to use a TLC file in Accelerator mode, instead of running interpretively.</td><td>Provides the option to use a TLC or MEX file in Accelerator mode.</td></tr><tr><td>Model reference</td><td>Cannot be used in a referenced model.</td><td>Supports Normal and Accelerator mode simulations when used in a referenced model. Requires a TLC file for Accelerator mode.</td><td>Provides options for sample time inheritance and Normal mode support when used in a referenced model. See <a href="https://www.mathworks.com/help/releases/R2018b/simulink/ug/model-referencing-limitations.html">Model Reference Requirements and Limitations</a></td></tr><tr><td><code>Simulink.<br>AliasType</code> and <code>Simulink.<br>NumericType</code> support</td><td>Does not support these classes.</td><td>Supports <code>Simulink. NumericType</code> and <code>Simulink. AliasType</code> classes (see <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/custom-data-types.html">Configure Custom Data Types</a>).</td><td>Supports all of these classes (see <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/custom-data-types.html">Configure Custom Data Types</a>).</td></tr><tr><td>Bus input and output signals</td><td>Does not support bus input or output signals.</td><td>Does not support bus input or output signals.</td><td>Supports nonvirtual bus input or output signals.</td></tr><tr><td>Tunable and run-time parameters</td><td>Supports tunable parameters during simulation. Does not support run-time parameters.</td><td>Supports tunable and run-time parameters.</td><td>Supports tunable and run-time parameters.</td></tr><tr><td>Work vectors</td><td>Does not support work vectors.</td><td>Supports DWork vectors (see <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/dwork-matlab.html#brd2qpw">Using DWork Vectors in Level-2 MATLAB S-Functions</a>).</td><td>Supports all work vector types (see <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/types-of-dwork-vectors.html">Types of DWork Vectors</a>).</td></tr></tbody></table><p><strong>Features of Automatically Generated S-Functions</strong></p><table summary="Features of Automatically Generated S-Functions"><colgroup><col width="28%"><col width="36%"><col width="36%"></colgroup><thead><tr><th>Feature</th><th>S-Function Builder</th><th>Legacy Code Tool</th></tr></thead><tbody><tr><td>Data types</td><td>Supports any data type supported by Simulink software, including fixed-point types.</td><td>Supports all built-in data types. To use a fixed-point data type, you must specify the data type as a <code>Simulink.NumericType</code>. You cannot use a fixed-point type with unspecified scaling.</td></tr><tr><td>Numeric types</td><td>Supports real and complex signals.</td><td>Supports complex signals only for built-in data types.</td></tr><tr><td>Frame support</td><td>Supports framed and unframed signals.</td><td>Does not support frame-based signals.</td></tr><tr><td>Port dimensions</td><td>Supports scalar, 1-D, and multidimensional input and output signals.</td><td>Supports scalar, 1-D, and multidimensional input and output signals.</td></tr><tr><td>S-function API</td><td>Supports creation of custom <code>mdlInitializeSizes</code>, <code>mdlInitializeSampleTimes</code>, <code>mdlDerivatives</code>, <code>mdlUpdate</code>, and <code>mdlOutputs</code>. Also allows for automatic generation of <code>mdlStart</code> and <code>mdlTerminate</code>.</td><td>Supports <code>mdlInitializeSizes</code>, <code>mdlInitializeSampleTimes</code>, <code>mdlStart</code>, <code>mdlInitializeConditions</code>, <code>mdlOutputs</code>, and <code>mdlTerminate</code>.</td></tr><tr><td>Code generation support</td><td>Natively supports code generation. Also, automatically generates a TLC file for inlining the S-function during code generation.</td><td>Natively supports code generation optimized for embedded systems. Also, automatically generates a TLC file that supports expression folding for inlining the S-function during code generation.</td></tr><tr><td><p>Simulink Accelerator\u2122 mode</p></td><td>Uses a TLC file in Accelerator mode, if the file was generated. Otherwise, uses the MEX file.</td><td>Provides the option to use a TLC or MEX file in Accelerator mode.</td></tr><tr><td>Model reference</td><td>Uses default behaviors when used in a referenced model.</td><td>Uses default behaviors when used in a referenced model.</td></tr><tr><td><code>Simulink.AliasType</code> and <code>Simulink.NumericType</code></td><td>Does not support these classes.</td><td>Supports <code>Simulink.AliasType</code> and <code>Simulink.NumericType</code>.</td></tr><tr><td>Bus input and output signals</td><td>Supports bus input and output signals. See <a href="matlab: open_system(&#39;sfbuilder_bususage&#39;)" target="_blank">sfbuilder_bususage</a> for an example.</td><td>Supports bus input and output signals. You must define a <code>Simulink.Bus</code> object in the MATLAB<sup>\xAE</sup> workspace that is equivalent to the structure of the input or output used in the legacy code. Does not support bus parameters.</td></tr><tr><td>Tunable and run-time parameters</td><td>Supports tunable parameters only during simulation. Supports run-time parameters.</td><td>Supports tunable and run-time parameters.</td></tr><tr><td>Work vectors</td><td>Does not provide access to work vectors.</td><td>Supports DWork vectors with the usage type <code>SS_DWORK_USED_AS_DWORK</code>. See <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/types-of-dwork-vectors.html">Types of DWork Vectors</a> for a discussion on the different DWork vector usage types.</td></tr></tbody></table><h3 id="s-function-limitations" tabindex="-1"><a class="header-anchor" href="#s-function-limitations" aria-hidden="true">#</a> S-Function Limitations</h3><p>The following table summarizes the major limitations of the different types of S-functions.</p><table><colgroup><col width="26%"><col width="74%"></colgroup><thead><tr><th>Implementation</th><th>Limitations</th></tr></thead><tbody><tr><td>Level-1 MATLAB S-function</td><td>Does not support the majority of S-function features. See the <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/s-function-features.html">S-Function Features and Limitations</a> section for information on what features a Level-1 MATLAB S-function does support.</td></tr><tr><td>Level-2 MATLAB S-functions</td><td><ul><li><p>Does not support bus input and output signals.</p></li><li><p>Cannot incorporate legacy code during simulation, only during code generation through a TLC file.</p></li></ul></td></tr><tr><td>Handwritten C MEX S-function</td><td>Supports model reference with some limitations. See <a href="https://www.mathworks.com/help/releases/R2018b/simulink/ug/model-referencing-limitations.html#bsp24qn-1">S-Functions in Referenced Models</a>.</td></tr><tr><td>S-Function Builder</td><td><ul><li><p>Generates S-function code using a wrapper function which incurs additional overhead.</p></li><li><p>Does not support the following S-function features:</p><ul><li><p>Work vectors</p></li><li><p>Port-based sample times</p></li><li><p>Multiple sample times or a nonzero offset time</p></li><li><p>Dynamically-sized input and output signals for an S-function with multiple input and output ports</p></li></ul></li></ul><h3 id="sr-toc-2">Note</h3><p>S-functions with one input and one output port can have dynamically-sized signals</p></td></tr><tr><td>Legacy Code Tool</td><td><ul><li><p>Generates C MEX S-functions for existing functions written in C or C++ only. The tool does not support transformation of MATLAB or Fortran functions.</p></li><li><p>Can interface with C++ functions, but not C++ objects.</p></li><li><p>Does not support simulating continuous or discrete states.</p></li><li><p>Does not support use of function pointers as the output of the legacy function being called.</p></li><li><p>Always sets the S-function&#39;s flag for <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/s-function-concepts.html#f6-14317">direct feedthrough</a> (<code>sizes.DirFeedthrough</code>) to <code>true</code>.</p></li><li><p>Supports only the continuous, but fixed in minor time step, <a href="https://www.mathworks.com/help/releases/R2018b/simulink/sfg/s-function-concepts.html#f6-24743">sample time and offset</a> option.</p></li><li><p>Supports complex numbers, but only with Simulink <a href="https://www.mathworks.com/help/releases/R2018b/simulink/ug/data-types-supported-by-simulink.html">built-in data types</a>.</p></li><li><p>Does not support the following S-function features:</p><ul><li><p>Work vectors, other than general DWork vectors</p></li><li><p>Frame-based input and output signals</p></li><li><p>Port-based sample times</p></li><li><p>Multiple block-based sample times</p></li></ul></li></ul></td></tr></tbody></table><p>\u53EF\u4EE5\u53D1\u73B0\uFF0C\u5EFA\u8BAE\u4F7F\u7528 level-2 s-function\u3002</p><h2 id="\u5B9E\u73B0-s-function" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0-s-function" aria-hidden="true">#</a> \u5B9E\u73B0 S-function</h2><h3 id="\u57FA\u672C\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u4ECB\u7ECD" aria-hidden="true">#</a> \u57FA\u672C\u4ECB\u7ECD</h3>',14),A=n("\u53C2\u8003\uFF1A "),P={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/writing-level-2-matlab-s-functions.html",target:"_blank",rel:"noopener noreferrer"},C=n("Write Level-2 MATLAB S-Functions - MATLAB & Simulink (mathworks.com)"),x=s("p",null,"\u9700\u8981\u6CE8\u610F\uFF0C\u5B9E\u73B0 s-function (level-2) \u5728\u7EC6\u8282\u4E0A\u6709\u5F88\u591A\u548C\u5B9E\u73B0 C MEX s-function \u63A5\u8FD1\uFF0C\u56E0\u6B64\u4E5F\u53EF\u4EE5\u53C2\u8003 C MEX \u7684\u5B9E\u73B0\u65B9\u5F0F\u3002",-1),M=s("p",null,"\u4E3A\u4E86\u5B9E\u73B0 s-function (level-2) \u7684\u529F\u80FD\uFF0Cmatlab \u5C06\u4E00\u4E2A\u8FD0\u884C\u65F6\u5BF9\u8C61\u4F5C\u4E3A\u53C2\u6570\u4F20\u9001\u5230\u56DE\u8C03\u65B9\u6CD5\u4E2D\u3002\u8FD0\u884C\u65F6\u5BF9\u8C61\u5B9E\u9645\u4E0A\u5145\u5F53\u4E86 matlab \u7684 s-function \u6A21\u5757\u4EE3\u7406\uFF0C\u4F7F\u5176\u80FD\u591F\u5728\u4EFF\u771F\u671F\u95F4\u8BBE\u7F6E\u3001\u8BBF\u95EE\u6A21\u578B\u5C5E\u6027\u3002",-1),R=n("\u5728 simulink engine \u8C03\u7528 level-2 \u7684 s-function \u56DE\u8C03\u51FD\u6570\u65F6\uFF0C\u5B83\u5C06\u4E00\u4E2A "),I={href:"https://www.mathworks.com/help/releases/R2021a/simulink/slref/simulink.msfcnruntimeblock.html",target:"_blank",rel:"noopener noreferrer"},B=s("code",null,"Simulink.MSFcnRunTimeBlock",-1),L=n(" \u7C7B\u7684\u5B9E\u4F8B\u4F5C\u4E3A\u8FD0\u884C\u65F6\u5BF9\u8C61\u4F20\u9012\u7ED9\u56DE\u8C03\u51FD\u6570 (\u548C CMEX s function \u7684 SimStruct \u7ED3\u6784\u4F53\u4F5C\u7528\u7C7B\u4F3C)\u3002\u6CE8\u610F\uFF0C\u8FD0\u884C\u65F6\u5BF9\u8C61\u4E0D\u652F\u6301 matlab sparse matrices\uFF0C\u56E0\u6B64 "),z=s("code",null,"speye",-1),F=n(" \u7B49\u51FD\u6570\u4E0D\u652F\u6301\u4F7F\u7528\u3002"),O={class:"custom-container note"},N=s("p",{class:"custom-container-title"},"note",-1),E=n("collapse: open title: Note Other MATLAB programs besides MATLAB S-functions can use run-time objects to obtain information about a MATLAB S-function in a model that is simulating. See "),W={href:"https://www.mathworks.com/help/releases/R2021a/simulink/ug/accessing-block-data-during-simulation.html",target:"_blank",rel:"noopener noreferrer"},q=n("Access Block Data During Simulation"),U=n(" in "),X=s("em",null,"Using Simulink",-1),V=n(" for more information."),H=s("h3",{id:"\u4ECE\u6A21\u677F\u5F00\u59CB",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u4ECE\u6A21\u677F\u5F00\u59CB","aria-hidden":"true"},"#"),n(" \u4ECE\u6A21\u677F\u5F00\u59CB")],-1),Y=s("p",null,[n("\u4F7F\u7528 Level-2 MATLAB S-function template "),s("a",{href:"./assets/msfuntmpl.m"},"`msfuntmpl_basic"),n(" \uFF0C\u5176\u4E2D\u5E26\u6709\u8F83\u591A\u7684\u6CE8\u91CA\u3002")],-1),j=n("\u53C2\u8003 "),G={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/writing-level-2-matlab-s-functions.html",target:"_blank",rel:"noopener noreferrer"},K=n("Level-2 MATLAB S-Function Callback Methods"),J=n(" \u540E\uFF0C\u9010\u6B65\u4ECB\u7ECD\u5982\u4F55\u5B8C\u6210\u4E00\u4E2A s function\u3002"),Q=s("p",null,[n("\u6A21\u578B\u53EF\u4EE5\u53C2\u8003 ["),s("code",null,"msfcndemo_sfundsc2"),n("](assets/msfcndemo_sfundsc2](./assets/msfcn_unit_delay.m) \uFF1A")],-1),Z=s("h4",{id:"\u6A21\u578B-setup",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u6A21\u578B-setup","aria-hidden":"true"},"#"),n(" \u6A21\u578B Setup")],-1),$=s("li",null,[s("p",null,[n("\u4FEE\u6539\u8FD0\u884C\u65F6\u5BF9\u8C61\u7684\u5C5E\u6027\uFF1A"),s("code",null,"NumInputPorts"),n(" \u548C "),s("code",null,"NumOutputPorts"),n(" \u4E3A 1 \u6765\u5B9E\u73B0 1 in 1 out\u3002")])],-1),ss=n("\u8C03\u7528\u8FD0\u884C\u65F6\u5BF9\u8C61\u7684\u65B9\u6CD5\uFF1A "),ns={href:"https://www.mathworks.com/help/releases/R2021a/simulink/slref/simulink.msfcnruntimeblock.html#f29-99863",target:"_blank",rel:"noopener noreferrer"},as=n("SetPreCompInpPortInfoToDynamic"),ts=n(" \u548C "),es={href:"https://www.mathworks.com/help/releases/R2021a/simulink/slref/simulink.msfcnruntimeblock.html#f29-99987",target:"_blank",rel:"noopener noreferrer"},os=n("SetPreCompOutPortInfoToDynamic"),ps=n(),is={href:"https://www.mathworks.com/help/releases/R2021a/simulink/slref/simulink.msfcnruntimeblock.html#f29-99987",target:"_blank",rel:"noopener noreferrer"},ls=n("SetPreCompOutPortInfoToDynamic"),cs=n(" \u6765\u8868\u660E\u8F93\u5165\u8F93\u51FA ports \u4ECE\u6A21\u578B\u7EE7\u627F\u7F16\u8BD1\u7684\u5C5E\u6027\uFF0C\u6BD4\u5982\u6570\u636E\u7C7B\u578B\uFF0C\u6570\u636E\u7EF4\u5EA6\uFF0C\u91C7\u6837\u7387\u7B49\u3002"),rs=s("li",null,[s("p",null,[n("\u8BBE\u7F6E\u8FD0\u884C\u65F6\u5BF9\u8C61\u7684 "),s("code",null,"InputPort"),n(" \u7684 "),s("code",null,"DirectFeedthrough"),n(" \u5C5E\u6027\u4E3A false\uFF0C\u8868\u660E\u8F93\u5165 port \u6CA1\u6709\u76F4\u63A5\u7684\u53CD\u9988\u8F93\u5165\u3002\u4E3A\u6240\u6709\u5176\u4F59\u7684\u8F93\u5165\u8F93\u51FA port \u7684\u5C5E\u6027\u4FDD\u7559\u539F\u6837\uFF0C\u5E76\u4E3A Dimensions\u3001DatatypeID \u548C Complexity \u5C5E\u6027\u8BBE\u7F6E\u7684\u503C\u8986\u76D6\u4F7F\u7528 SetPreCompInpPortInfoToDynamic \u548C SetPreCompOutPortInfoToDynamic \u65B9\u6CD5\u7EE7\u627F\u7684\u503C\u3002")])],-1),us=s("li",null,[s("p",null,[n("\u8BBE\u7F6E "),s("code",null,"NumDialogPrms"),n(" \u5C5E\u6027\u4E3A 1 \u6765\u521D\u59CB\u5316 s function \u7684\u7684 dialog parameter\u3002")])],-1),ms=n("\u8BBE\u7F6E "),ds=s("code",null,"SampleTimes",-1),ks=n(" \u5C5E\u6027\u4E3A [-1, 0] \u6765\u7EE7\u627F"),hs=s("mark",null,"\u91C7\u6837\u65F6\u95F4",-1),vs=n("\u3002\u5173\u4E8E\u91C7\u6837\u65F6\u95F4\uFF0C\u53EF\u4EE5\u53C2\u8003 "),bs=n("\u91C7\u6837\u65F6\u95F4\u7C7B\u578B"),fs=n("\u3002"),gs=e(`<li><p>\u8C03\u7528 <code>RegBlockMethod</code> \u65B9\u6CD5\u6765\u6CE8\u518C\u4E0B\u5217\u56DE\u8C03\u51FD\u6570</p><ul><li><p>PostPropagationSetup</p></li><li><p>InitializeConditions</p></li><li><p>Outputs</p></li><li><p>Update</p><p>\u5C06\u6A21\u677F\u4E2D\u5176\u4F59\u6CE8\u518C\u7684\u56DE\u8C03\u51FD\u6570\u5220\u9664\u3002\u6B64\u5916\uFF0C\u5728\u8C03\u7528 <code>RegBlockMethod</code> \u65B9\u6CD5\u65F6\uFF0C\u7B2C\u4E00\u4E2A\u53C2\u6570\u662F s function API method \u7684\u540D\u5B57\uFF0C\u7B2C\u4E8C\u4E2A\u8F93\u5165\u53C2\u6570\u662F\u5BF9\u5E94\u672C\u5730\u5904\u7406\u8FD9\u4E9B\u51FD\u6570\u7684\u540D\u5B57\uFF0C\u6BD4\u5982 <code>block.RegBlockMethod(&#39;PostPropagationSetup&#39;,@DoPostPropSetup);</code></p></li></ul><p>\u4E0B\u9762\u8FD9\u662F\u4E00\u4E2A\u521D\u59CB\u5316\u7684\u4F8B\u5B50\uFF0C\u6765\u6E90\u4E8E <a href="./assets/msfcn_unit_delay.m">\`msfcn_unit_delay</a> \uFF1A</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>

<span class="token comment">%% Register a single dialog parameter</span>
block<span class="token punctuation">.</span>NumDialogPrms  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">%% Register number of input and output ports</span>
block<span class="token punctuation">.</span>NumInputPorts  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
block<span class="token punctuation">.</span>NumOutputPorts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">%% Setup functional port properties to dynamically</span>
<span class="token comment">%% inherited.</span>
block<span class="token punctuation">.</span>SetPreCompInpPortInfoToDynamic<span class="token punctuation">;</span>
block<span class="token punctuation">.</span>SetPreCompOutPortInfoToDynamic<span class="token punctuation">;</span>

<span class="token comment">%% Hard-code certain port properties(choose from this and upper one)</span>
block<span class="token punctuation">.</span><span class="token function">InputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Dimensions        <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
block<span class="token punctuation">.</span><span class="token function">InputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DirectFeedthrough <span class="token operator">=</span> false<span class="token punctuation">;</span>

block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Dimensions       <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">%% Set block sample time to [0.1 0]</span>
block<span class="token punctuation">.</span>SampleTimes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">%% Register methods</span>
block<span class="token punctuation">.</span><span class="token function">RegBlockMethod</span><span class="token punctuation">(</span><span class="token string">&#39;PostPropagationSetup&#39;</span><span class="token punctuation">,</span><span class="token operator">@</span>DoPostPropSetup<span class="token punctuation">)</span><span class="token punctuation">;</span>
block<span class="token punctuation">.</span><span class="token function">RegBlockMethod</span><span class="token punctuation">(</span><span class="token string">&#39;InitializeConditions&#39;</span><span class="token punctuation">,</span><span class="token operator">@</span>InitConditions<span class="token punctuation">)</span><span class="token punctuation">;</span>
block<span class="token punctuation">.</span><span class="token function">RegBlockMethod</span><span class="token punctuation">(</span><span class="token string">&#39;Outputs&#39;</span><span class="token punctuation">,</span>             <span class="token operator">@</span>Output<span class="token punctuation">)</span><span class="token punctuation">;</span>  
block<span class="token punctuation">.</span><span class="token function">RegBlockMethod</span><span class="token punctuation">(</span><span class="token string">&#39;Update&#39;</span><span class="token punctuation">,</span>              <span class="token operator">@</span>Update<span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u679C s function \u9700\u8981\u8FDE\u7EED\u72B6\u6001\uFF0C\u4F7F\u7528 <code>NumContStates</code> \u77E5\u540D\u8FDE\u7EED\u72B6\u6001\u7684\u6570\u76EE\uFF0C\u79BB\u6563\u72B6\u6001\u4E0D\u9700\u8981\u8FD9\u4E2A\u3002</p></li>`,1),_s=n("\u9700\u8981\u6CE8\u610F\uFF0C\u5982\u679C\u4F7F\u7528\u7684"),ys=s("mark",null,"s function \u4F5C\u4E3A\u6E90\u4FE1\u53F7\u8F93\u51FA",-1),Ss=n("\uFF0C\u90A3\u4E48\u9700\u8981\u6307\u5B9A\u5176\u8F93\u51FA\u6A21\u5F0F\uFF0C\u662F\u91C7\u6837\u4FE1\u53F7\u8F93\u51FA\u8FD8\u662F\u5E27\u8F93\u51FA\u3002\u53EF\u4EE5\u53C2\u8003 "),ws={href:"https://www.mathworks.com/help/dsp/ug/sample-and-frame-based-concepts.html",target:"_blank",rel:"noopener noreferrer"},Ds=n("Sample- and Frame-Based Concepts - MATLAB & Simulink (mathworks.com)"),Ts=n("\u3002"),As=e(`<p>\u5177\u4F53\u4EE3\u7801\u53C2\u8003\u5982\u4E0B\uFF1A</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code>block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SamplingMode <span class="token operator">=</span> <span class="token string">&#39;Sample&#39;</span><span class="token punctuation">;</span> <span class="token comment">% sample mode</span>
block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SamplingMode <span class="token operator">=</span> <span class="token string">&#39;Frame&#39;</span><span class="token punctuation">;</span> <span class="token comment">% frame mode</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5173\u4E8E <code>Frame</code> \u6A21\u5F0F\u53C2\u8003 <code>sfundemos</code> \u4E0B matlab s fucntion \u4E2D\u7684 <code>Frame signals</code>\u3002</p><p>\u6211\u81EA\u5DF1\u5B9E\u73B0\u7684\u8F93\u51FA\u5E38\u503C\u4FE1\u53F7\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">msfuntmpl_basic</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
<span class="token comment">%MSFUNTMPL_BASIC A Template for a Level-2 MATLAB S-Function</span>
<span class="token comment">%   The MATLAB S-function is written as a MATLAB function with the</span>
<span class="token comment">%   same name as the S-function. Replace &#39;msfuntmpl_basic&#39; with the </span>
<span class="token comment">%   name of your S-function.</span>

<span class="token comment">%   Copyright 2003-2018 The MathWorks, Inc.</span>

<span class="token comment">%%</span>
<span class="token comment">%% The setup method is used to set up the basic attributes of the</span>
<span class="token comment">%% S-function such as ports, parameters, etc. Do not add any other</span>
<span class="token comment">%% calls to the main body of the function.</span>
<span class="token comment">%%</span>
<span class="token function">setup</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">%endfunction</span>

<span class="token comment">%% Function: setup ===================================================</span>
<span class="token comment">%% Abstract:</span>
<span class="token comment">%%   Set up the basic characteristics of the S-function block such as:</span>
<span class="token comment">%%   - Input ports</span>
<span class="token comment">%%   - Output ports</span>
<span class="token comment">%%   - Dialog parameters</span>
<span class="token comment">%%   - Options</span>
<span class="token comment">%%</span>
<span class="token comment">%%   Required         : Yes</span>
<span class="token comment">%%   C MEX counterpart: mdlInitializeSizes</span>
<span class="token comment">%%</span>
<span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>

<span class="token comment">% Register number of ports</span>
block<span class="token punctuation">.</span>NumInputPorts  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
block<span class="token punctuation">.</span>NumOutputPorts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">% Setup port properties to be inherited or dynamic</span>
block<span class="token punctuation">.</span>SetPreCompInpPortInfoToDynamic<span class="token punctuation">;</span>
block<span class="token punctuation">.</span>SetPreCompOutPortInfoToDynamic<span class="token punctuation">;</span>

<span class="token comment">% Override input port properties</span>
<span class="token comment">% block.InputPort(1).Dimensions        = 1;</span>
<span class="token comment">% block.InputPort(1).DatatypeID  = 0;  % double</span>
<span class="token comment">% block.InputPort(1).Complexity  = &#39;Real&#39;;</span>
<span class="token comment">% block.InputPort(1).DirectFeedthrough = true;</span>

<span class="token comment">% Override output port properties</span>
block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Dimensions       <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DatatypeID  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">% double</span>
block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Complexity  <span class="token operator">=</span> <span class="token string">&#39;Real&#39;</span><span class="token punctuation">;</span>

block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SamplingMode <span class="token operator">=</span> <span class="token string">&#39;Sample&#39;</span><span class="token punctuation">;</span>

<span class="token comment">% Register parameters</span>
block<span class="token punctuation">.</span>NumDialogPrms     <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">% Register sample times</span>
<span class="token comment">%  [0 offset]            : Continuous sample time</span>
<span class="token comment">%  [positive_num offset] : Discrete sample time</span>
%
<span class="token comment">%  [-1, 0]               : Inherited sample time</span>
<span class="token comment">%  [-2, 0]               : Variable sample time</span>
block<span class="token punctuation">.</span>SampleTimes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">% Specify the block simStateCompliance. The allowed values are:</span>
<span class="token comment">%    &#39;UnknownSimState&#39;, &lt; The default setting; warn and assume DefaultSimState</span>
<span class="token comment">%    &#39;DefaultSimState&#39;, &lt; Same sim state as a built-in block</span>
<span class="token comment">%    &#39;HasNoSimState&#39;,   &lt; No sim state</span>
<span class="token comment">%    &#39;CustomSimState&#39;,  &lt; Has GetSimState and SetSimState methods</span>
<span class="token comment">%    &#39;DisallowSimState&#39; &lt; Error out when saving or restoring the model sim state</span>
block<span class="token punctuation">.</span>SimStateCompliance <span class="token operator">=</span> <span class="token string">&#39;DefaultSimState&#39;</span><span class="token punctuation">;</span>

<span class="token comment">%% -----------------------------------------------------------------</span>
<span class="token comment">%% The MATLAB S-function uses an internal registry for all</span>
<span class="token comment">%% block methods. You should register all relevant methods</span>
<span class="token comment">%% (optional and required) as illustrated below. You may choose</span>
<span class="token comment">%% any suitable name for the methods and implement these methods</span>
<span class="token comment">%% as local functions within the same file. See comments</span>
<span class="token comment">%% provided for each function for more information.</span>
<span class="token comment">%% -----------------------------------------------------------------</span>

<span class="token comment">% block.RegBlockMethod(&#39;PostPropagationSetup&#39;,    @DoPostPropSetup);</span>
<span class="token comment">% block.RegBlockMethod(&#39;InitializeConditions&#39;, @InitializeConditions);</span>
<span class="token comment">% block.RegBlockMethod(&#39;Start&#39;, @Start);</span>
block<span class="token punctuation">.</span><span class="token function">RegBlockMethod</span><span class="token punctuation">(</span><span class="token string">&#39;Outputs&#39;</span><span class="token punctuation">,</span> <span class="token operator">@</span>Outputs<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">% Required</span>
<span class="token comment">% block.RegBlockMethod(&#39;Update&#39;, @Update);</span>
<span class="token comment">% block.RegBlockMethod(&#39;Derivatives&#39;, @Derivatives);</span>
<span class="token comment">% block.RegBlockMethod(&#39;Terminate&#39;, @Terminate); % Required</span>

<span class="token comment">%end setup</span>

<span class="token comment">%%</span>
<span class="token comment">%% PostPropagationSetup:</span>
<span class="token comment">%%   Functionality    : Setup work areas and state variables. Can</span>
<span class="token comment">%%                      also register run-time methods here</span>
<span class="token comment">%%   Required         : No</span>
<span class="token comment">%%   C MEX counterpart: mdlSetWorkWidths</span>
<span class="token comment">%%</span>
<span class="token comment">% function DoPostPropSetup(block)</span>
<span class="token comment">%   block.NumDworks = 1;</span>
  
<span class="token comment">%   block.Dwork(1).Name            = &#39;x1&#39;;</span>
<span class="token comment">%   block.Dwork(1).Dimensions      = 1;</span>
<span class="token comment">%   block.Dwork(1).DatatypeID      = 0;      % double</span>
<span class="token comment">%   block.Dwork(1).Complexity      = &#39;Real&#39;; % real</span>
<span class="token comment">%   block.Dwork(1).UsedAsDiscState = true;</span>


<span class="token comment">%%</span>
<span class="token comment">%% InitializeConditions:</span>
<span class="token comment">%%   Functionality    : Called at the start of simulation and if it is </span>
<span class="token comment">%%                      present in an enabled subsystem configured to reset </span>
<span class="token comment">%%                      states, it will be called when the enabled subsystem</span>
<span class="token comment">%%                      restarts execution to reset the states.</span>
<span class="token comment">%%   Required         : No</span>
<span class="token comment">%%   C MEX counterpart: mdlInitializeConditions</span>
<span class="token comment">%%</span>
<span class="token comment">% function InitializeConditions(block)</span>

<span class="token comment">%end InitializeConditions</span>


<span class="token comment">%%</span>
<span class="token comment">%% Start:</span>
<span class="token comment">%%   Functionality    : Called once at start of model execution. If you</span>
<span class="token comment">%%                      have states that should be initialized once, this </span>
<span class="token comment">%%                      is the place to do it.</span>
<span class="token comment">%%   Required         : No</span>
<span class="token comment">%%   C MEX counterpart: mdlStart</span>
<span class="token comment">%%</span>
<span class="token comment">% function Start(block)</span>

<span class="token comment">% block.Dwork(1).Data = 0;</span>

<span class="token comment">%end Start</span>

<span class="token comment">%%</span>
<span class="token comment">%% Outputs:</span>
<span class="token comment">%%   Functionality    : Called to generate block outputs in</span>
<span class="token comment">%%                      simulation step</span>
<span class="token comment">%%   Required         : Yes</span>
<span class="token comment">%%   C MEX counterpart: mdlOutputs</span>
<span class="token comment">%%</span>
<span class="token keyword">function</span> <span class="token function">Outputs</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>

block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">DialogPrm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data<span class="token punctuation">;</span>

<span class="token comment">%end Outputs</span>

<span class="token comment">%%</span>
<span class="token comment">%% Update:</span>
<span class="token comment">%%   Functionality    : Called to update discrete states</span>
<span class="token comment">%%                      during simulation step</span>
<span class="token comment">%%   Required         : No</span>
<span class="token comment">%%   C MEX counterpart: mdlUpdate</span>
<span class="token comment">%%</span>
<span class="token comment">% function Update(block)</span>

<span class="token comment">% block.Dwork(1).Data = block.InputPort(1).Data;</span>

<span class="token comment">%end Update</span>

<span class="token comment">%%</span>
<span class="token comment">%% Derivatives:</span>
<span class="token comment">%%   Functionality    : Called to update derivatives of</span>
<span class="token comment">%%                      continuous states during simulation step</span>
<span class="token comment">%%   Required         : No</span>
<span class="token comment">%%   C MEX counterpart: mdlDerivatives</span>
<span class="token comment">%%</span>
<span class="token comment">% function Derivatives(block)</span>

<span class="token comment">%end Derivatives</span>

<span class="token comment">%%</span>
<span class="token comment">%% Terminate:</span>
<span class="token comment">%%   Functionality    : Called at the end of simulation for cleanup</span>
<span class="token comment">%%   Required         : Yes</span>
<span class="token comment">%%   C MEX counterpart: mdlTerminate</span>
<span class="token comment">%%</span>
<span class="token comment">% function Terminate(block)</span>
<span class="token comment">%end Terminate</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u79BB\u6563\u72B6\u6001\u5C5E\u6027\u8BBE\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u79BB\u6563\u72B6\u6001\u5C5E\u6027\u8BBE\u7F6E" aria-hidden="true">#</a> \u79BB\u6563\u72B6\u6001\u5C5E\u6027\u8BBE\u7F6E</h4>`,6),Ps=n("\u5BF9\u5E94 "),Cs=s("code",null,"PostPropagationSetup",-1),xs=n(" \u56DE\u8C03\u51FD\u6570\u8FDB\u884C\u5B9E\u73B0\u3002\u6CE8\u610F level 2 s function \u5C06\u79BB\u6563\u72B6\u6001\u4FE1\u606F\u5B58\u50A8\u5728 DWork Vector \u4E2D\uFF0C\u53C2\u8003 "),Ms={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/dwork-matlab.html#brd2qpw",target:"_blank",rel:"noopener noreferrer"},Rs=n("Use DWork Vectors in S-Functions - MATLAB & Simulink (mathworks.com)"),Is=n("\u3002"),Bs=e(`<blockquote><p>If multiple instances of your S-function can occur in a model, your S-function must use DWork vectors instead of global or static memory to store instance-specific values of S-function variables.</p></blockquote><p>\u4E0B\u9762\u662F\u5BF9\u5E94\u4E0A\u9762\u4EE3\u7801\u4E2D <code>DoPostPropSetup</code> \u7684\u5B9E\u73B0\u90E8\u5206\uFF1A</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">DoPostPropSetup</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>

  <span class="token comment">%% Setup Dwork</span>
  block<span class="token punctuation">.</span>NumDworks <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&#39;x0&#39;</span><span class="token punctuation">;</span> 
  block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Dimensions      <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DatatypeID      <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Complexity      <span class="token operator">=</span> <span class="token string">&#39;Real&#39;</span><span class="token punctuation">;</span>
  block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>UsedAsDiscState <span class="token operator">=</span> true<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u5C06 DWork \u7684\u540D\u5B57\u8BBE\u5B9A\u4E3A\u4E86 <code>x0</code>\u3002</p><h4 id="\u521D\u59CB\u5316\u521D\u59CB\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u521D\u59CB\u5316\u521D\u59CB\u6761\u4EF6" aria-hidden="true">#</a> \u521D\u59CB\u5316\u521D\u59CB\u6761\u4EF6</h4><p>\u521D\u59CB\u5316\u521D\u59CB\u6761\u4EF6\u5BF9\u5E94\u7684 <code>InitConditions</code>\u3002\u8FD9\u91CC\u6709\u4E24\u79CD\u521D\u59CB\u5316\u65B9\u5F0F\uFF1A</p><ul><li><code>Start</code> \u56DE\u8C03\u51FD\u6570\u9002\u7528\u4E8E\u5728\u4EFF\u771F\u5F00\u59CB\u4EC5\u8C03\u7528\u4E00\u6B21\u7684\u60C5\u5F62</li><li><code>InitializeConditions</code> \u56DE\u8C03\u51FD\u6570\u9002\u7528\u4E8E\u8FD9\u4E2A s function \u5305\u542B\u4E8E\u4E00\u4E2A\u5B50\u7CFB\u7EDF (subsystem) \u4E2D\uFF0C\u4E14\u8FD9\u4E2A\u5B50\u7CFB\u7EDF\u4F1A\u88AB\u91CD\u542F\u7684\u60C5\u5F62\u3002\u4F1A\u5BF9\u91CD\u542F\u7684\u5B50\u7CFB\u7EDF\u4E2D\u7684\u5BF9\u5E94\u53D8\u91CF\u91CD\u65B0\u521D\u59CB\u5316\u3002</li></ul><p>\u5BF9\u4E0B\u9762\u4F8B\u5B50\uFF0C\u5176\u4F7F\u7528\u4E86\u4E86 <code>InitializeConditions</code> \u6765\u8BBE\u7F6E\u79BB\u6563\u72B6\u6001\u7684\u521D\u503C\u4E3A\u4F7F\u7528\u7684 dialog parameter \u503C\u3002</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">InitConditions</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>

  <span class="token comment">%% Initialize Dwork</span>
  block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">DialogPrm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),Ls=n("\u8FD9\u91CC "),zs=s("code",null,"DialogPrm",-1),Fs=n(" \u5C5E\u6027\u53EF\u4EE5\u53C2\u8003 "),Os={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/dialog-parameters-matlab.html",target:"_blank",rel:"noopener noreferrer"},Ns=n("Pass Dialog Parameters to S-Functions - MATLAB & Simulink (mathworks.com)"),Es=n("\uFF0C\u591A\u8F93\u5165\u7684 Parameters \u7C7B\u4F3C "),Ws=s("code",null,"1.0,2.0,3.0",-1),qs=n(" \u5BF9\u5E94\u4E09\u4E2A\u8F93\u5165\u53C2\u6570\u3002"),Us=e(`<div class="custom-container note"><p class="custom-container-title">note</p><p>collapse: open title: Note \u6CE8\u610F\u8FD9\u91CC<code>1.0,2.0,3.0</code>\u4E0D\u80FD\u5199\u6210<code>[1.0,2.0,3.0]</code>,\u540E\u8005\u88AB\u8BA4\u4E3A\u662F\u4E00\u4E2A\u53D8\u91CF</p></div><p>\u5BF9\u8FDE\u7EED\u72B6\u6001\u800C\u8A00\uFF0C\u4F7F\u7528\u7C7B\u4F3C <code> block.ContStates.Data(1) = 1.0;</code> \u7684\u4EE3\u7801\u6765\u521D\u59CB\u5316\u3002</p><h4 id="\u8BA1\u7B97\u8F93\u51FA" tabindex="-1"><a class="header-anchor" href="#\u8BA1\u7B97\u8F93\u51FA" aria-hidden="true">#</a> \u8BA1\u7B97\u8F93\u51FA</h4><p>\u5BF9\u5E94 <code>Outputs</code> \u56DE\u8C03\u51FD\u6570\u7684\u5B9E\u73B0\uFF0C\u8FD9\u91CC\u8F93\u51FA\u4E3A\uFF1A</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">Output</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>

  block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u8BA1\u7B97\u5FAE\u5206" tabindex="-1"><a class="header-anchor" href="#\u8BA1\u7B97\u5FAE\u5206" aria-hidden="true">#</a> \u8BA1\u7B97\u5FAE\u5206</h4><p>\u5BF9\u8FDE\u7EED\u72B6\u6001\u800C\u8A00\uFF0C\u4F7F\u7528 <code>Derivatives</code> \u56DE\u8C03\u51FD\u6570\u5BF9\u5E94\u7684\u51FD\u6570\uFF0C\u8BA1\u7B97\u8FDE\u7EED\u7684\u5FAE\u5206\u72B6\u6001\uFF0C\u5176\u7ED3\u679C\u5B58\u50A8\u5728 <code>Derivatives</code> \u7684\u5C5E\u6027\u4E2D\uFF0C\u6BD4\u5982\u4E0B\u9762\u8FD9\u4E2A\u5C31\u5C06\u7B2C\u4E00\u4E2A\u72B6\u6001\u7684\u5FAE\u5206\u8BBE\u4E3A\u4E86\u7B2C\u4E00\u4E2A\u8F93\u5165\u4FE1\u53F7:</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code>block<span class="token punctuation">.</span>Derivatives<span class="token punctuation">.</span><span class="token function">Data</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">InputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6CE8\u610F\u4F8B\u5B50\u4E2D\u5E76\u6CA1\u6709\u8FDE\u7EED\u7684\u72B6\u6001\uFF0C\u56E0\u6B64\u6CA1\u6709\u5B9E\u73B0\u8FD9\u4E00\u56DE\u8C03\u51FD\u6570\u3002</p><h4 id="\u5237\u65B0\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#\u5237\u65B0\u72B6\u6001" aria-hidden="true">#</a> \u5237\u65B0\u72B6\u6001</h4><p>\u5BF9\u5E94 <code>Update</code> \u56DE\u8C03\u51FD\u6570\uFF0C\u5B9E\u73B0\u5237\u65B0\u79BB\u6563\u72B6\u6001\u7684\u4EE3\u7801\u3002\u8FD9\u91CC\u5C31\u5C06\u5F53\u524D\u8F93\u5165\u7684\u6570\u636E\u4ED8\u7ED9\u79BB\u6563\u72B6\u6001\u7684\u503C\uFF1A</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">Update</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>

  block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">InputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data<span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u7ED3\u675F\u7A0B\u5E8F" tabindex="-1"><a class="header-anchor" href="#\u7ED3\u675F\u7A0B\u5E8F" aria-hidden="true">#</a> \u7ED3\u675F\u7A0B\u5E8F</h4><p>Perform any cleanup, such as clearing variables or memory, in the <code>Terminate</code> method. Unlike C MEX S-functions, Level-2 MATLAB S-function are not required to have a <code>Terminate</code> method.</p><h3 id="\u8FDB\u9636" tabindex="-1"><a class="header-anchor" href="#\u8FDB\u9636" aria-hidden="true">#</a> \u8FDB\u9636</h3><p>\u5BF9\u4E8E\u53EF\u53D8 size \u7684\u8F93\u5165\u8F93\u51FA\uFF0C\u53C2\u8003\u4E0B\u9762\u4EE3\u7801\u5B9E\u73B0\uFF1A</p><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
<span class="token comment">% Register the properties of the output port</span>
block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DimensionsMode <span class="token operator">=</span> <span class="token string">&#39;Variable&#39;</span><span class="token punctuation">;</span>
block<span class="token punctuation">.</span><span class="token function">RegBlockMethod</span><span class="token punctuation">(</span><span class="token string">&#39;SetInputPortDimensionsMode&#39;</span><span class="token punctuation">,</span>  <span class="token operator">@</span>SetInputDimsMode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">DoPostPropSetup</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
<span class="token comment">%Register dependency rules to update current output size of output port a depending on</span>
<span class="token comment">%input ports b and c</span>
block<span class="token punctuation">.</span><span class="token function">AddOutputDimsDependencyRules</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">[</span>b c<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">@</span>setOutputVarDims<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">%Configure output port b to have the same dimensions as input port a</span>
block<span class="token punctuation">.</span><span class="token function">InputPortSameDimsAsOutputPort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">%Configure DWork a to have its size reset when input size changes.</span>
block<span class="token punctuation">.</span><span class="token function">DWorkRequireResetForSignalSize</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">SetInputDimsMode</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> port<span class="token punctuation">,</span> dm<span class="token punctuation">)</span>
<span class="token comment">% Set dimension mode</span>
block<span class="token punctuation">.</span><span class="token function">InputPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span>DimensionsMode <span class="token operator">=</span> dm<span class="token punctuation">;</span>
block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span>DimensionsMode <span class="token operator">=</span> dm<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">setOutputVarDims</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> opIdx<span class="token punctuation">,</span> inputIdx<span class="token punctuation">)</span>
<span class="token comment">% Set current (run-time) dimensions of the output</span>
outDimsAfterReset <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">InputPort</span><span class="token punctuation">(</span><span class="token function">inputIdx</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>CurrentDimensions<span class="token punctuation">;</span>
block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span>opIdx<span class="token punctuation">)</span><span class="token punctuation">.</span>CurrentDimensions <span class="token operator">=</span> outDimsAfterReset<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,17),Xs=n("For information on additional callback methods, see "),Vs={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/writing-level-2-matlab-s-functions.html#f7-68222",target:"_blank",rel:"noopener noreferrer"},Hs=n("Level-2 MATLAB S-Function Callback Methods"),Ys=n(". For a list of run-time object properties, see the reference page for "),js={href:"https://www.mathworks.com/help/releases/R2021a/simulink/slref/simulink.msfcnruntimeblock.html",target:"_blank",rel:"noopener noreferrer"},Gs=s("code",null,"Simulink.MSFcnRunTimeBlock",-1),Ks=n(" and the parent class "),Js={href:"https://www.mathworks.com/help/releases/R2021a/simulink/slref/simulink.runtimeblock.html",target:"_blank",rel:"noopener noreferrer"},Qs=s("code",null,"Simulink.RunTimeBlock",-1),Zs=n("."),$s=s("h2",{id:"\u66F4\u591A\u4F8B\u5B50",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u66F4\u591A\u4F8B\u5B50","aria-hidden":"true"},"#"),n(" \u66F4\u591A\u4F8B\u5B50")],-1),sn=n("\u53C2\u8003 "),nn={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/s-function-examples.html",target:"_blank",rel:"noopener noreferrer"},an=n("S-Function Examples - MATLAB & Simulink (mathworks.com)"),tn=s("p",null,"\u4E2A\u4EBA\u89C9\u5F97\u8FD9\u4E2A\u9650\u5236\u79EF\u5206\u5668\u6BD4\u8F83\u4E0D\u9519:",-1),en=s("p",null,[s("a",{href:"./assets/msfcn_limintm.m"},"msfcn_limintm")],-1),on=s("p",null,[s("a",{href:"./assets/msfcndemo_limintm.slx"},"msfcndemo_limintm")],-1),pn=s("p",null,[n("\u6211\u81EA\u5DF1\u5199\u4E86\u4E00\u4E2A"),s("mark",null,"\u5012\u7ACB\u6446\u7684\u6A21\u578B"),n("\uFF0C\u4F7F\u7528\u4E86\u8FDE\u7EED\u72B6\u6001\uFF0Cconstates\uFF0C\u53EF\u4EE5\u53C2\u8003\u4E00\u4E0B\uFF1A")],-1),ln=s("li",null,[s("a",{href:"./assets/pendulum_plant.m"},"\u5012\u7ACB\u6446\u5EFA\u6A21")],-1),cn=n("ESN_MPC_test"),rn=n("\u6A21\u578B\u7269\u7406\u6A21\u5F0F\u53C2\u8003\uFF1A"),un={href:"https://zhuanlan.zhihu.com/p/358140662",target:"_blank",rel:"noopener noreferrer"},mn=n("\u52A8\u529B\u5B66\u5EFA\u6A21-\u62C9\u683C\u6717\u65E5\u65B9\u7A0B - \u77E5\u4E4E (zhihu.com)"),dn=e(`<h2 id="\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u95EE\u9898" aria-hidden="true">#</a> \u95EE\u9898</h2><p>DWork \u76EE\u524D\u53EA\u80FD\u5B58\u50A8\u5411\u91CF\uFF0C\u5982\u4F55\u5728 s function \u4E2D\u5B58\u50A8\u77E9\u9635\u72B6\u6001\uFF1F</p><h2 id="\u6CE8\u610F" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u610F" aria-hidden="true">#</a> \u6CE8\u610F</h2><ul><li>s function \u4E2D\u652F\u6301\u4E2D\u95F4\u53D8\u91CF\uFF0C\u6BD4\u5982\u4E0B\u9762\u4EE3\u7801 ok</li></ul><div class="language-matlab ext-matlab line-numbers-mode"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">Outputs</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
	 y <span class="token operator">=</span> block<span class="token punctuation">.</span><span class="token function">Dwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
	 block<span class="token punctuation">.</span><span class="token function">OutputPort</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Data <span class="token operator">=</span> <span class="token number">0.2</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u8FDE\u7EED\u72B6\u6001\u6CA1\u6709\u7EF4\u6570\u7684\u6982\u5FF5\uFF0C\u53EA\u80FD\u4E3A\u5355\u7EF4\u5EA6\u7684\u3002</li></ul><h2 id="\u53C2\u8003" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003" aria-hidden="true">#</a> \u53C2\u8003</h2>`,7),kn={href:"https://www.mathworks.com/help/releases/R2021a/simulink/s-function-basics-matlab.html",target:"_blank",rel:"noopener noreferrer"},hn=n("MATLAB S-Function Basics - MATLAB & Simulink (mathworks.com)"),vn={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/writing-level-2-matlab-s-functions.html",target:"_blank",rel:"noopener noreferrer"},bn=n("Write Level-2 MATLAB S-Functions - MATLAB & Simulink (mathworks.com)"),fn={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/s-function-examples.html",target:"_blank",rel:"noopener noreferrer"},gn=n("S-Function Examples - MATLAB & Simulink (mathworks.com)"),_n={href:"https://www.mathworks.com/help/releases/R2021a/simulink/sfg/dialog-parameters-matlab.html",target:"_blank",rel:"noopener noreferrer"},yn=n("Pass Dialog Parameters to S-Functions - MATLAB & Simulink (mathworks.com)"),Sn={href:"https://www.mathworks.com/help/simulink/ug/how-to-specify-the-sample-time.html",target:"_blank",rel:"noopener noreferrer"},wn=n("Specify Sample Time - MATLAB & Simulink (mathworks.com)"),Dn={href:"https://www.mathworks.com/help/dsp/ug/sample-and-frame-based-concepts.html",target:"_blank",rel:"noopener noreferrer"},Tn=n("Sample- and Frame-Based Concepts - MATLAB & Simulink (mathworks.com)");function An(Pn,Cn){const o=i("RouterLink"),t=i("ExternalLinkIcon");return c(),r("div",null,[m,s("p",null,[d,a(o,{to:"/tool/matlab/simulink-%E6%89%A7%E8%A1%8C%E7%BB%86%E8%8A%82.html"},{default:p(()=>[k]),_:1}),h]),v,s("p",null,[b,a(o,{to:"/tool/matlab/"},{default:p(()=>[f]),_:1}),g]),_,s("p",null,[y,s("a",S,[w,a(t)]),D]),T,s("p",null,[A,s("a",P,[C,a(t)])]),x,M,s("p",null,[R,s("a",I,[B,a(t)]),L,z,F]),s("div",O,[N,s("p",null,[E,s("a",W,[q,a(t)]),U,X,V])]),H,Y,s("p",null,[j,s("a",G,[K,a(t)]),J]),Q,Z,s("ul",null,[$,s("li",null,[s("p",null,[ss,s("a",ns,[as,a(t)]),ts,s("a",es,[os,a(t)]),ps,s("a",is,[ls,a(t)]),cs])]),rs,us,s("li",null,[s("p",null,[ms,ds,ks,hs,vs,a(o,{to:"/tool/matlab/%E9%87%87%E6%A0%B7%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B.html"},{default:p(()=>[bs]),_:1}),fs])]),gs]),s("p",null,[_s,ys,Ss,s("a",ws,[Ds,a(t)]),Ts]),As,s("p",null,[Ps,Cs,xs,s("a",Ms,[Rs,a(t)]),Is]),Bs,s("p",null,[Ls,zs,Fs,s("a",Os,[Ns,a(t)]),Es,Ws,qs]),Us,s("p",null,[Xs,s("a",Vs,[Hs,a(t)]),Ys,s("a",js,[Gs,a(t)]),Ks,s("a",Js,[Qs,a(t)]),Zs]),$s,s("p",null,[sn,s("a",nn,[an,a(t)])]),tn,en,on,pn,s("ul",null,[ln,s("li",null,[a(o,{to:"/tool/matlab/"},{default:p(()=>[cn]),_:1})])]),s("p",null,[rn,s("a",un,[mn,a(t)])]),dn,s("ul",null,[s("li",null,[s("p",null,[s("a",kn,[hn,a(t)])])]),s("li",null,[s("p",null,[s("a",vn,[bn,a(t)])])]),s("li",null,[s("p",null,[s("a",fn,[gn,a(t)])])]),s("li",null,[s("p",null,[s("a",_n,[yn,a(t)])])]),s("li",null,[s("p",null,[s("a",Sn,[wn,a(t)])])]),s("li",null,[s("p",null,[s("a",Dn,[Tn,a(t)])])])])])}var Rn=l(u,[["render",An],["__file","s-function.html.vue"]]);export{Rn as default};
